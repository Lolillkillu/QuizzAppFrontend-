<div class="multiplayer-container">
  <div *ngIf="viewState === 'init'" class="init-container">
    <h2>Stwórz nową grę multiplayer</h2>
    <div class="connection-status">
      Status połączenia: 
      <span [class.connected]="connectionStatus === 'connected'"
            [class.connecting]="connectionStatus === 'connecting'"
            [class.disconnected]="connectionStatus === 'disconnected'">
        {{ getConnectionStatusText() }}
      </span>
    </div>
    
    <button (click)="createGame()" 
            [disabled]="isSubmitting || connectionStatus !== 'connected'">
      {{ isSubmitting ? 'Tworzenie...' : 'Stwórz grę' }}
    </button>
    
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>
    
    <div *ngIf="isSubmitting" class="loading-indicator">
      <div class="spinner"></div>
      <p>Tworzenie gry...</p>
    </div>
  </div>

  <div *ngIf="viewState === 'gameCreated'" class="game-created-container">
    <h2>Gra utworzona pomyślnie!</h2>
    
    <div class="connection-status">
      Status połączenia: 
      <span [class.connected]="connectionStatus === 'connected'"
            [class.connecting]="connectionStatus === 'connecting'"
            [class.disconnected]="connectionStatus === 'disconnected'">
        {{ getConnectionStatusText() }}
      </span>
    </div>
    
    <div class="link-share-info">
      <p>Udostępnij ten link innym graczom:</p>
      <div class="game-link">{{ gameLink }}</div>
      <button (click)="copyGameLink()" class="copy-button">
        <i class="copy-icon">📋</i> Kopiuj link
      </button>
    </div>
    
    <h3>Teraz dołącz do gry jako host:</h3>
    <div class="name-input">
      <input #hostNameInput type="text" placeholder="Twoje imię" [disabled]="isJoining"/>
      <button (click)="joinGame(hostNameInput.value)" 
              [disabled]="isJoining || connectionStatus !== 'connected'">
        {{ isJoining ? 'Dołączanie...' : 'Dołącz do gry' }}
      </button>
      <div *ngIf="errorMessage" class="error-message">
        {{ errorMessage }}
      </div>
    </div>
  </div>

  <div *ngIf="viewState === 'nameInput'" class="name-input">
    <h2>Dołącz do gry multiplayer</h2>
    <input #playerNameInput type="text" placeholder="Twoje imię" [disabled]="isJoining"/>
    
    <div class="connection-status">
      Status połączenia: 
      <span [class.connected]="connectionStatus === 'connected'"
            [class.connecting]="connectionStatus === 'connecting'"
            [class.disconnected]="connectionStatus === 'disconnected'">
        {{ getConnectionStatusText() }}
      </span>
    </div>
    
    <button (click)="joinGame(playerNameInput.value)" 
            [disabled]="isJoining || connectionStatus !== 'connected'">
      {{ isJoining ? 'Dołączanie...' : 'Dołącz do gry' }}
    </button>
    
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>
    
    <div *ngIf="isJoining" class="loading-indicator">
      <div class="spinner"></div>
      <p>Dołączanie do gry...</p>
    </div>
  </div>

  <div *ngIf="viewState === 'inGame'">
    <div *ngIf="gameStatus === 'waiting'">
      <h2>Oczekiwanie na graczy</h2>
      
      <div class="connection-status">
        Status połączenia: 
        <span [class.connected]="connectionStatus === 'connected'"
              [class.connecting]="connectionStatus === 'connecting'"
              [class.disconnected]="connectionStatus === 'disconnected'">
          {{ getConnectionStatusText() }}
        </span>
      </div>
      
      <div class="game-id-container">
        <p>ID gry: <strong>{{ gameId }}</strong></p>
        <button class="copy-button" (click)="copyGameLink()">
          <i class="copy-icon">📋</i> Kopiuj link
        </button>
      </div>
      
      <div class="link-share-info">
        <p>Udostępnij ten link innym graczom:</p>
        <div class="game-link">{{ gameLink || 'Generowanie linku...' }}</div>
      </div>
      
      <div class="players-list-container">
        <h3>Gracze w lobby ({{ players.length }}/2):</h3>
        <div class="players-list">
          <div *ngFor="let player of players" class="player-card">
            <div class="player-avatar">{{ player.isHost ? '👑' : '👤' }}</div>
            <div class="player-name">{{ player.name }}</div>
          </div>
          <div *ngIf="players.length < 2" class="player-card waiting">
            <div class="player-avatar">⏳</div>
            <div class="player-name">Oczekiwanie na drugiego gracza...</div>
          </div>
        </div>
      </div>

      <div *ngIf="!isPlayerReady" class="ready-section">
        <button (click)="markPlayerReady()" class="ready-button">
          Jestem gotowy!
        </button>
      </div>
      <div *ngIf="isPlayerReady" class="waiting-message">
        Oczekiwanie na drugiego gracza...
      </div>
    </div>

    <div *ngIf="gameStatus === 'in-progress'">
      <div class="game-info">
        <div>Twoje punkty: {{ currentScore }}</div>
        <div>Postęp: {{ playerProgress }}/10</div> <!-- Dodany postęp -->
        <div>Gracze online: {{ players.length }}</div>
      </div>

      <h2>{{ currentQuestion?.questionText }}</h2>
      
      <div class="answers-grid">
        <div 
          *ngFor="let answer of currentQuestion?.answers" 
          class="answer-card"
          [class.selected]="answer === selectedAnswer"
          [class.correct]="isAnswerSelected && answer.isCorrect"
          [class.incorrect]="isAnswerSelected && !answer.isCorrect && answer === selectedAnswer"
          (click)="selectAnswer(answer)"
        >
          {{ answer.answerText }}
        </div>
      </div>
      
      <div *ngIf="isAnswerSelected" class="feedback-message">
        <div *ngIf="selectedAnswer?.isCorrect" class="correct-feedback">
          Poprawna odpowiedź!
        </div>
        <div *ngIf="!selectedAnswer?.isCorrect" class="incorrect-feedback">
          Niestety, to nie jest poprawna odpowiedź
        </div>
      </div>
    </div>

    <div *ngIf="gameStatus === 'completed' && !playerCompleted" class="waiting-results">
      <h2>Gratulacje! Ukończyłeś grę!</h2>
      <div class="waiting-message">
        <p>Oczekiwanie na zakończenie gry przez pozostałych graczy...</p>
        <div class="loading-spinner"></div>
      </div>
    </div>

    <div *ngIf="gameStatus === 'completed' && playerCompleted">
      <h2>Gra zakończona!</h2>
      <div class="results">
        <h3>Ranking graczy:</h3>
        <div *ngFor="let player of players; let i = index" class="player-result">
          <span class="player-position">#{{i + 1}}</span>
          <span class="player-name">{{ player.name }}</span>
          <span class="player-score">{{ player.score }} punktów</span>
        </div>
      </div>
      <button class="restart-button" (click)="restartGame()">Zagraj ponownie</button>
    </div>

    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>
  </div>
</div>